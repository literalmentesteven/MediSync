<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MediSync.LoginPage"
             Title="Inicio de Sesión - MediSync"
             Shell.NavBarIsVisible="False"
             Loaded="OnPageLoaded"> <!-- <== PASO 1: Añadido el evento 'Loaded' -->

    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="ColorAcentoMediSync">#00B2CA</Color>
            <Color x:Key="ColorTextoPrincipal">#333333</Color>
            <Color x:Key="ColorTextoSecundario">#888888</Color>
            <Color x:Key="ColorFondoVidrio">#FFFFF7B0</Color>
            <Color x:Key="ColorBordeSuave">#E0E0E0</Color>
            <Color x:Key="ColorOlaGradienteInicio">#FFFFFF</Color>
            <Color x:Key="ColorOlaGradienteFin">#E0F8FA</Color>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ContentPage.Background>
        <!-- PASO 2: Le damos un nombre al gradiente para poder animarlo -->
        <LinearGradientBrush x:Name="BackgroundGradient" StartPoint="0,0" EndPoint="1,1">
            <!-- Creamos la "banda de color" que se moverá -->
            <GradientStop Offset="0.0" Color="{StaticResource ColorOlaGradienteInicio}" />
            <GradientStop Offset="0.4" Color="#FFBEFAFF" />
            <GradientStop Offset="0.6" Color="#FFBEFAFF" />
            <GradientStop Offset="1.0" Color="{StaticResource ColorOlaGradienteInicio}" />
        </LinearGradientBrush>
    </ContentPage.Background>

    <Grid VerticalOptions="Center" HorizontalOptions="Center">
        <VerticalStackLayout>

            <Image
                Source="medisync_logo.png"
                WidthRequest="640"
                Aspect="AspectFit"
                Margin="0,0,0,30"
                SemanticProperties.Description="Logo de MediSync" />

            <!-- Corregido el color de fondo que tenías en 'LightYellow' -->
            <Border
                BackgroundColor="#FFF8F2CD"
                Stroke="{StaticResource ColorBordeSuave}"
                StrokeThickness="1"
                WidthRequest="450"
                HorizontalOptions="Center"
                Padding="32">
                
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>
                <Border.Shadow>
                    <Shadow Brush="Black" Opacity="0.1" Radius="30" Offset="0,15" />
                </Border.Shadow>

                <VerticalStackLayout Spacing="15">
                    <Label 
                        Text="Iniciar Sesión"
                        TextColor="{StaticResource ColorTextoPrincipal}"
                        FontSize="24"
                        FontAttributes="Bold"
                        HorizontalOptions="Center"
                        Margin="0,0,0,10" />

                    <!-- PASO 3: Damos nombre al Border y conectamos eventos al Entry -->
                    <Border x:Name="UserBorder" Stroke="{StaticResource ColorBordeSuave}" StrokeThickness="1" BackgroundColor="White">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>
                        <Entry
                            x:Name="IdEntry"
                            Placeholder="Nombre de usuario"
                            PlaceholderColor="{StaticResource ColorTextoSecundario}"
                            TextColor="{StaticResource ColorTextoPrincipal}" 
                            VerticalOptions="Center"
                            HeightRequest="48"
                            Margin="8,0"
                            Focused="OnEntryFocused"
                            Unfocused="OnEntryUnfocused" />
                    </Border>
                    
                    <!-- PASO 4: Damos nombre al Border y conectamos eventos al Entry -->
                    <Border x:Name="PassBorder" Stroke="{StaticResource ColorBordeSuave}" StrokeThickness="1" BackgroundColor="White">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>
                        <Entry
                            x:Name="PasswordEntry"
                            Placeholder="Contraseña"
                            PlaceholderColor="{StaticResource ColorTextoSecundario}"
                            TextColor="{StaticResource ColorTextoPrincipal}"
                            IsPassword="True"
                            VerticalOptions="Center"
                            HeightRequest="48"
                            Margin="8,0"
                            Focused="OnEntryFocused"
                            Unfocused="OnEntryUnfocused" />
                    </Border>
                    
                    <Button
                        x:Name="LoginButton"
                        Text="Entrar"
                        BackgroundColor="{StaticResource ColorAcentoMediSync}"
                        TextColor="White"
                        CornerRadius="25"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        Margin="0,10,0,0"
                        Clicked="OnLoginButtonClicked" />

                    <Label
                        Text="¿Olvidaste tu contraseña?"
                        TextColor="{StaticResource ColorTextoSecundario}"
                        HorizontalOptions="Center"
                        FontSize="14"
                        Margin="0,5,0,0">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnForgotPasswordTapped" />
                        </Label.GestureRecognizers>
                    </Label>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>
    </Grid>
</ContentPage>